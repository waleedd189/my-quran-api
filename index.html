<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù‚Ø±Ø¢Ù† ÙƒØ±ÙŠÙ…</title>
<link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; }

body { 
    font-family: 'Amiri', serif; 
    background: #eceff1; 
    text-align: center; 
    padding: 20px; 
    margin: 0;
}

.container { 
    max-width: 900px; 
    margin: auto; 
    background: white; 
    padding: 30px; 
    border-radius: 20px; 
    box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
}

h1 { 
    color: #1b5e20; 
    font-size: 32px;
    margin-bottom: 20px;
}

.controls {
    display: flex;
    gap: 10px;
    justify-content: center;
    flex-wrap: wrap;
    margin-bottom: 20px;
}

select { 
    padding: 12px 15px; 
    min-width: 200px;
    border-radius: 10px; 
    border: 2px solid #4caf50; 
    font-size: 16px; 
    cursor: pointer; 
    font-family: 'Amiri', serif;
    background: white;
}

.ayah { 
    background: #f1f8e9; 
    padding: 20px 25px; 
    margin: 15px 0; 
    border-right: 8px solid #4caf50; 
    font-size: 26px; 
    line-height: 2.2; 
    text-align: right; 
    border-radius: 8px; 
    font-family: 'Amiri', serif;
    position: relative;
}

.ayah-number {
    display: inline-block;
    background: #4caf50;
    color: white;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    text-align: center;
    line-height: 35px;
    margin-left: 10px;
    font-size: 16px;
    vertical-align: middle;
}

.ayah-actions {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
    margin-top: 15px;
    padding-top: 10px;
    border-top: 1px solid #c8e6c9;
}

.btn {
    background: transparent;
    border: 2px solid #4caf50;
    color: #4caf50;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.btn:hover {
    background: #4caf50;
    color: white;
}

.btn-stop { border-color: #f44336; color: #f44336; }
.btn-stop:hover { background: #f44336; color: white; }

.btn-pause { border-color: #ff9800; color: #ff9800; }
.btn-pause:hover { background: #ff9800; color: white; }

.surah-header { 
    background: #1b5e20; 
    color: white; 
    padding: 15px; 
    border-radius: 10px; 
    font-size: 28px; 
    margin-bottom: 20px; 
    font-family: 'Amiri', serif;
}

.player-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #1b5e20;
    padding: 15px;
    display: none;
    flex-direction: column;
    gap: 10px;
    box-shadow: 0 -5px 20px rgba(0,0,0,0.2);
}

.player-bar.show {
    display: flex;
}

.player-info {
    color: white;
    font-size: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.player-bar audio {
    width: 100%;
}

.playing {
    background: #c8e6c9 !important;
    border-right-color: #2e7d32 !important;
}

.loading {
    opacity: 0.6;
}
</style>
</head>
<body>
<div class="container">
<h1>Ù‚Ø±Ø¢Ù† ÙƒØ±ÙŠÙ… ğŸ“–</h1>
<div class="controls">
    <select id="surahSelect" onchange="loadSurah()">
        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø© --</option>
    </select>
    <select id="reciterSelect" onchange="saveReciter()">
        <optgroup label="ğŸ‡ªğŸ‡¬ Ù‚Ø±Ø§Ø¡ Ù…ØµØ±">
            <option value="ar.alafasy" selected>Ù…Ø´Ø§Ø±ÙŠ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ</option>
            <option value="ar.abdulbasitmurattal">Ø¹Ø¨Ø¯ Ø§Ù„Ø¨Ø§Ø³Ø· Ø¹Ø¨Ø¯ Ø§Ù„ØµÙ…Ø¯</option>
            <option value="ar.minshawi">Ù…Ø­Ù…Ø¯ ØµØ¯ÙŠÙ‚ Ø§Ù„Ù…Ù†Ø´Ø§ÙˆÙŠ</option>
            <option value="ar.husary">Ù…Ø­Ù…ÙˆØ¯ Ø®Ù„ÙŠÙ„ Ø§Ù„Ø­ØµØ±ÙŠ</option>
            <option value="ar.husarymujawwad">Ø§Ù„Ø­ØµØ±ÙŠ Ù…Ø¬ÙˆØ¯</option>
            <option value="ar.muhammadayyoub">Ù…Ø­Ù…Ø¯ Ø£ÙŠÙˆØ¨</option>
        </optgroup>
        <optgroup label="ğŸ•‹ Ù‚Ø±Ø§Ø¡ Ø§Ù„Ø­Ø±Ù… Ø§Ù„Ù…ÙƒÙŠ">
            <option value="ar.abdurrahmaansudais">Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø³Ø¯ÙŠØ³</option>
            <option value="ar.saudalshuraim">Ø³Ø¹ÙˆØ¯ Ø§Ù„Ø´Ø±ÙŠÙ…</option>
            <option value="ar.mahermuaiqly">Ù…Ø§Ù‡Ø± Ø§Ù„Ù…Ø¹ÙŠÙ‚Ù„ÙŠ</option>
            <option value="ar.yasseradress">ÙŠØ§Ø³Ø± Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ</option>
        </optgroup>
        <optgroup label="ğŸŒ Ù‚Ø±Ø§Ø¡ Ø¹Ø§Ù„Ù…ÙŠÙˆÙ†">
            <option value="ar.abdullahbasfar">Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø¨ØµÙØ±</option>
            <option value="ar.abdurrashidsofi">Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø´ÙŠØ¯ ØµÙˆÙÙŠ</option>
        </optgroup>
    </select>
</div>
<div id="content">Ø§Ø®ØªØ± Ø³ÙˆØ±Ø© Ù„Ù„Ø¨Ø¯Ø¡</div>
</div>

<div class="player-bar" id="playerBar">
<div class="player-info">
    <span>ğŸ§</span>
    <span id="playerInfo">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ´ØºÙŠÙ„...</span>
</div>
<audio id="audioPlayer" controls></audio>
</div>

<script>
const surahNames = ["Ø§Ù„ÙØ§ØªØ­Ø©","Ø§Ù„Ø¨Ù‚Ø±Ø©","Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†","Ø§Ù„Ù†Ø³Ø§Ø¡","Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©","Ø§Ù„Ø£Ù†Ø¹Ø§Ù…","Ø§Ù„Ø£Ø¹Ø±Ø§Ù","Ø§Ù„Ø£Ù†ÙØ§Ù„","Ø§Ù„ØªÙˆØ¨Ø©","ÙŠÙˆÙ†Ø³","Ù‡ÙˆØ¯","ÙŠÙˆØ³Ù","Ø§Ù„Ø±Ø¹Ø¯","Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…","Ø§Ù„Ø­Ø¬Ø±","Ø§Ù„Ù†Ø­Ù„","Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡","Ø§Ù„ÙƒÙ‡Ù","Ù…Ø±ÙŠÙ…","Ø·Ù‡","Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡","Ø§Ù„Ø­Ø¬","Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†","Ø§Ù„Ù†ÙˆØ±","Ø§Ù„ÙØ±Ù‚Ø§Ù†","Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡","Ø§Ù„Ù†Ù…Ù„","Ø§Ù„Ù‚ØµØµ","Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª","Ø§Ù„Ø±ÙˆÙ…","Ù„Ù‚Ù…Ø§Ù†","Ø§Ù„Ø³Ø¬Ø¯Ø©","Ø§Ù„Ø£Ø­Ø²Ø§Ø¨","Ø³Ø¨Ø£","ÙØ§Ø·Ø±","ÙŠØ³","Ø§Ù„ØµØ§ÙØ§Øª","Øµ","Ø§Ù„Ø²Ù…Ø±","ØºØ§ÙØ±","ÙØµÙ„Øª","Ø§Ù„Ø´ÙˆØ±Ù‰","Ø§Ù„Ø²Ø®Ø±Ù","Ø§Ù„Ø¯Ø®Ø§Ù†","Ø§Ù„Ø¬Ø§Ø«ÙŠØ©","Ø§Ù„Ø£Ø­Ù‚Ø§Ù","Ù…Ø­Ù…Ø¯","Ø§Ù„ÙØªØ­","Ø§Ù„Ø­Ø¬Ø±Ø§Øª","Ù‚","Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª","Ø§Ù„Ø·ÙˆØ±","Ø§Ù„Ù†Ø¬Ù…","Ø§Ù„Ù‚Ù…Ø±","Ø§Ù„Ø±Ø­Ù…Ù†","Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©","Ø§Ù„Ø­Ø¯ÙŠØ¯","Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©","Ø§Ù„Ø­Ø´Ø±","Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©","Ø§Ù„ØµÙ","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†","Ø§Ù„ØªØºØ§Ø¨Ù†","Ø§Ù„Ø·Ù„Ø§Ù‚","Ø§Ù„ØªØ­Ø¬ÙŠÙ„","Ø§Ù„Ù…Ù„Ùƒ","Ø§Ù„Ù‚Ù„Ù…","Ø§Ù„Ø­Ø§Ù‚Ø©","Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬","Ù†ÙˆØ­","Ø§Ù„Ø¬Ù†","Ø§Ù„Ù…Ø²Ù…Ù„","Ø§Ù„Ù…Ø¯Ø«Ø±","Ø§Ù„Ù‚ÙŠØ§Ù…Ø©","Ø§Ù„Ø¥Ù†Ø³Ø§Ù†","Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª","Ø§Ù„Ù†Ø¨Ø£","Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª","Ø¹Ø¨Ø³","Ø§Ù„ØªÙƒÙˆÙŠØ±","Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±","Ø§Ù„Ù…Ø·ÙÙÙŠÙ†","Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚","Ø§Ù„Ø¨Ø±ÙˆØ¬","Ø§Ù„Ø·Ø§Ø±Ù‚","Ø§Ù„Ø£Ø¹Ù„Ù‰","Ø§Ù„ØºØ§Ø´ÙŠØ©","Ø§Ù„ÙØ¬Ø±","Ø§Ù„Ø¨Ù„Ø¯","Ø§Ù„Ø´Ù…Ø³","Ø§Ù„Ù„ÙŠÙ„","Ø§Ù„Ø¶Ø­Ù‰","Ø§Ù„Ø´Ø±Ø­","Ø§Ù„ØªÙŠÙ†","Ø§Ù„Ø¹Ù„Ù‚","Ø§Ù„Ù‚Ø¯Ø±","Ø§Ù„Ø¨ÙŠÙ†Ø©","Ø§Ù„Ø²Ù„Ø²Ù„Ø©","Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª","Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©","Ø§Ù„ØªÙƒØ§Ø«Ø±","Ø§Ù„Ø¹ØµØ±","Ø§Ù„Ù‡Ù…Ø²Ø©","Ø§Ù„ÙÙŠÙ„","Ù‚Ø±ÙŠØ´","Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†","Ø§Ù„ÙƒÙˆØ«Ø±","Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†","Ø§Ù„Ù†ØµØ±","Ø§Ù„Ù…Ø³Ø¯","Ø§Ù„Ø¥Ø®Ù„Ø§Øµ","Ø§Ù„ÙÙ„Ù‚","Ø§Ù„Ù†Ø§Ø³"];

let currentReciter = localStorage.getItem('reciter') || 'ar.alafasy';
let currentAyahs = [];
let currentSurahId = 1;
let currentAyahId = null;
let isPlaying = false;

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø±Ø¦ Ø§Ù„Ù…Ø­ÙÙˆØ¸
document.getElementById('reciterSelect').value = currentReciter;

// Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙˆØ±
const select = document.getElementById('surahSelect');
surahNames.forEach((name, index) => {
    let option = document.createElement('option');
    option.value = index + 1;
    option.textContent = (index + 1) + ". " + name;
    select.appendChild(option);
});

// Ø­ÙØ¸ Ø§Ù„Ù…Ù‚Ø±Ø¦
function saveReciter() {
    currentReciter = document.getElementById('reciterSelect').value;
    localStorage.setItem('reciter', currentReciter);
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙˆØ±Ø©
async function loadSurah() {
    const id = select.value;
    if(!id) return;
    
    currentSurahId = parseInt(id);
    const contentDiv = document.getElementById('content');
    contentDiv.innerHTML = "Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
    
    try {
        const response = await fetch('/api?surah=' + id);
        const result = await response.json();
        
        if(result.success === false) {
            contentDiv.innerHTML = "Ø­Ø¯Ø« Ø®Ø·Ø£: " + result.error;
            return;
        }
        
        currentAyahs = result.ayahs;
        renderSurah(result);
    } catch (e) {
        contentDiv.innerHTML = "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±";
    }
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø³ÙˆØ±Ø©
function renderSurah(result) {
    let html = '<div class="surah-header">Ø³ÙˆØ±Ø© ' + result.name + '</div>';
    
    result.ayahs.forEach(ayah => {
        const audioUrl = getAudioUrl(ayah.id);
        html += `
        <div class="ayah" id="ayah-${ayah.aya_no}" data-id="${ayah.id}">
            <span class="ayah-number">${ayah.aya_no}</span>
            ${ayah.aya_text_emlaey}
            <div class="ayah-actions">
                <button class="btn" onclick="playAyah(${ayah.id}, ${ayah.aya_no})" title="ØªØ´ØºÙŠÙ„">â–¶</button>
                <button class="btn btn-pause" onclick="pauseAudio()" title="Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª">â¸</button>
                <button class="btn btn-stop" onclick="stopAudio()" title="Ø¥ÙŠÙ‚Ø§Ù">â¹</button>
            </div>
        </div>`;
    });
    
    document.getElementById('content').innerHTML = html;
}

// Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØª
function getAudioUrl(ayahId) {
    return `https://cdn.islamic.network/quran/audio/128/${currentReciter}/${ayahId}.mp3`;
}

// ØªØ´ØºÙŠÙ„ Ø¢ÙŠØ©
function playAyah(ayahId, ayahNo) {
    const audio = document.getElementById('audioPlayer');
    const audioUrl = getAudioUrl(ayahId);
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    document.querySelectorAll('.ayah').forEach(el => el.classList.remove('playing'));
    document.getElementById('ayah-' + ayahNo)?.classList.add('playing');
    
    currentAyahId = ayahId;
    
    audio.src = audioUrl;
    audio.play().then(() => {
        isPlaying = true;
        showPlayer(surahNames[currentSurahId - 1], ayahNo);
    }).catch(err => {
        console.error('Error playing:', err);
        alert('ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª');
    });
}

// ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¢ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ©
function playNext() {
    if (!currentAyahs || currentAyahs.length === 0) return;
    
    const currentAyah = currentAyahs.find(a => a.id === currentAyahId);
    if (!currentAyah) return;
    
    const nextAyahNo = currentAyah.aya_no + 1;
    const nextAyah = currentAyahs.find(a => a.aya_no === nextAyahNo);
    
    if (nextAyah) {
        playAyah(nextAyah.id, nextAyah.aya_no);
    } else {
        // Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø³ÙˆØ±Ø©
        stopAudio();
    }
}

// Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª
function pauseAudio() {
    const audio = document.getElementById('audioPlayer');
    if (audio.paused) {
        audio.play();
    } else {
        audio.pause();
    }
}

// Ø¥ÙŠÙ‚Ø§Ù
function stopAudio() {
    const audio = document.getElementById('audioPlayer');
    audio.pause();
    audio.currentTime = 0;
    isPlaying = false;
    document.querySelectorAll('.ayah').forEach(el => el.classList.remove('playing'));
    hidePlayer();
}

// Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø´ØºÙ„
function showPlayer(surahName, ayahNo) {
    document.getElementById('playerInfo').textContent = surahName + ' - Ø¢ÙŠØ© ' + ayahNo;
    document.getElementById('playerBar').classList.add('show');
}

// Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø´ØºÙ„
function hidePlayer() {
    document.getElementById('playerBar').classList.remove('show');
}

// Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙˆØª
document.getElementById('audioPlayer').addEventListener('ended', playNext);
</script>
</body>
</html>
