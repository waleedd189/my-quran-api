// ุณูุฑูุจุช ุชูููุฏ ููู ุจูุงูุงุช ุงููุฑุขู ุงููุงูู
// ุดุบู: node generate-quran-data.js

const https = require('https');
const fs = require('fs');

const QURAN_API = 'https://api.alquran.cloud/v1';

// ุชุญููู ุงูุจูุงูุงุช ูู API
function fetch(url) {
    return new Promise((resolve, reject) => {
        https.get(url, (res) => {
            let data = '';
            res.on('data', chunk => data += chunk);
            res.on('end', () => {
                try {
                    resolve(JSON.parse(data));
                } catch (e) {
                    reject(e);
                }
            });
        }).on('error', reject);
    });
}

// ุชุฃุฎูุฑ ุจุณูุท ุจูู ุงูุทูุจุงุช
function delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

async function generateQuranData() {
    console.log('๐ ุจุฏุก ุชุญููู ุจูุงูุงุช ุงููุฑุขู ุงููุฑูู...\n');
    
    const quranData = {
        meta: {
            source: 'ูุตุญู ูููุฏ ุงูุฅููุชุฑููู',
            version: '1.0.0',
            generated_at: new Date().toISOString(),
            total_surahs: 114,
            total_ayahs: 6236
        },
        surahs: []
    };
    
    // ุฃุณูุงุก ุงูุณูุฑ
    const surahNames = [
        "ุงููุงุชุญุฉ", "ุงูุจูุฑุฉ", "ุขู ุนูุฑุงู", "ุงููุณุงุก", "ุงููุงุฆุฏุฉ", "ุงูุฃูุนุงู", "ุงูุฃุนุฑุงู", "ุงูุฃููุงู", "ุงูุชูุจุฉ", "ูููุณ",
        "ููุฏ", "ููุณู", "ุงูุฑุนุฏ", "ุฅุจุฑุงููู", "ุงูุญุฌุฑ", "ุงููุญู", "ุงูุฅุณุฑุงุก", "ุงูููู", "ูุฑูู", "ุทู",
        "ุงูุฃูุจูุงุก", "ุงูุญุฌ", "ุงููุคูููู", "ุงูููุฑ", "ุงููุฑูุงู", "ุงูุดุนุฑุงุก", "ุงูููู", "ุงููุตุต", "ุงูุนููุจูุช", "ุงูุฑูู",
        "ูููุงู", "ุงูุณุฌุฏุฉ", "ุงูุฃุญุฒุงุจ", "ุณุจุฃ", "ูุงุทุฑ", "ูุณ", "ุงูุตุงูุงุช", "ุต", "ุงูุฒูุฑ", "ุบุงูุฑ",
        "ูุตูุช", "ุงูุดูุฑู", "ุงูุฒุฎุฑู", "ุงูุฏุฎุงู", "ุงูุฌุงุซูุฉ", "ุงูุฃุญูุงู", "ูุญูุฏ", "ุงููุชุญ", "ุงูุญุฌุฑุงุช", "ู",
        "ุงูุฐุงุฑูุงุช", "ุงูุทูุฑ", "ุงููุฌู", "ุงูููุฑ", "ุงูุฑุญูู", "ุงููุงูุนุฉ", "ุงูุญุฏูุฏ", "ุงููุฌุงุฏูุฉ", "ุงูุญุดุฑ", "ุงูููุชุญูุฉ",
        "ุงูุตู", "ุงูุฌูุนุฉ", "ุงูููุงูููู", "ุงูุชุบุงุจู", "ุงูุทูุงู", "ุงูุชุญุฑูู", "ุงูููู", "ุงูููู", "ุงูุญุงูุฉ", "ุงููุนุงุฑุฌ",
        "ููุญ", "ุงูุฌู", "ุงููุฒูู", "ุงููุฏุซุฑ", "ุงูููุงูุฉ", "ุงูุฅูุณุงู", "ุงููุฑุณูุงุช", "ุงููุจุฃ", "ุงููุงุฒุนุงุช", "ุนุจุณ",
        "ุงูุชูููุฑ", "ุงูุงููุทุงุฑ", "ุงููุทูููู", "ุงูุงูุดูุงู", "ุงูุจุฑูุฌ", "ุงูุทุงุฑู", "ุงูุฃุนูู", "ุงูุบุงุดูุฉ", "ุงููุฌุฑ", "ุงูุจูุฏ",
        "ุงูุดูุณ", "ุงูููู", "ุงูุถุญู", "ุงูุดุฑุญ", "ุงูุชูู", "ุงูุนูู", "ุงููุฏุฑ", "ุงูุจููุฉ", "ุงูุฒูุฒูุฉ", "ุงูุนุงุฏูุงุช",
        "ุงููุงุฑุนุฉ", "ุงูุชูุงุซุฑ", "ุงูุนุตุฑ", "ุงูููุฒุฉ", "ุงูููู", "ูุฑูุด", "ุงููุงุนูู", "ุงูููุซุฑ", "ุงููุงูุฑูู", "ุงููุตุฑ",
        "ุงููุณุฏ", "ุงูุฅุฎูุงุต", "ุงูููู", "ุงููุงุณ"
    ];
    
    // ุฃุณูุงุก ุงูุณูุฑ ุจุงูุฅูุฌููุฒู
    const surahNamesEn = [
        "Al-Fatiha", "Al-Baqara", "Aal-Imran", "An-Nisa", "Al-Ma'ida", "Al-An'am", "Al-A'raf", "Al-Anfal", "At-Tawba", "Yunus",
        "Hud", "Yusuf", "Ar-Ra'd", "Ibrahim", "Al-Hijr", "An-Nahl", "Al-Isra", "Al-Kahf", "Maryam", "Ta-Ha",
        "Al-Anbiya", "Al-Hajj", "Al-Mu'minun", "An-Nur", "Al-Furqan", "Ash-Shu'ara", "An-Naml", "Al-Qasas", "Al-Ankabut", "Ar-Rum",
        "Luqman", "As-Sajda", "Al-Ahzab", "Saba", "Fatir", "Ya-Sin", "As-Saffat", "Sad", "Az-Zumar", "Ghafir",
        "Fussilat", "Ash-Shura", "Az-Zukhruf", "Ad-Dukhan", "Al-Jathiya", "Al-Ahqaf", "Muhammad", "Al-Fath", "Al-Hujurat", "Qaf",
        "Adh-Dhariyat", "At-Tur", "An-Najm", "Al-Qamar", "Ar-Rahman", "Al-Waqi'a", "Al-Hadid", "Al-Mujadila", "Al-Hashr", "Al-Mumtahina",
        "As-Saff", "Al-Jumu'a", "Al-Munafiqun", "At-Taghabun", "At-Talaq", "At-Tahrim", "Al-Mulk", "Al-Qalam", "Al-Haqqa", "Al-Ma'arij",
        "Nuh", "Al-Jinn", "Al-Muzzammil", "Al-Muddaththir", "Al-Qiyama", "Al-Insan", "Al-Mursalat", "An-Naba", "An-Nazi'at", "Abasa",
        "At-Takwir", "Al-Infitar", "Al-Mutaffifin", "Al-Inshiqaq", "Al-Buruj", "At-Tariq", "Al-A'la", "Al-Ghashiya", "Al-Fajr", "Al-Balad",
        "Ash-Shams", "Al-Layl", "Ad-Dhuha", "Ash-Sharh", "At-Tin", "Al-Alaq", "Al-Qadr", "Al-Bayyina", "Az-Zalzala", "Al-Adiyat",
        "Al-Qari'a", "At-Takathur", "Al-Asr", "Al-Humaza", "Al-Fil", "Quraysh", "Al-Ma'un", "Al-Kawthar", "Al-Kafirun", "An-Nasr",
        "Al-Masad", "Al-Ikhlas", "Al-Falaq", "An-Nas"
    ];
    
    // ุนุฏุฏ ุขูุงุช ูู ุณูุฑุฉ
    const ayahCounts = [
        7, 286, 200, 176, 120, 165, 206, 75, 129, 109, 123, 111, 43, 52, 99, 128, 111, 110, 98, 135,
        112, 78, 118, 64, 77, 227, 93, 88, 69, 60, 34, 30, 73, 54, 45, 83, 182, 88, 75, 85,
        54, 53, 89, 59, 37, 35, 38, 29, 18, 45, 60, 49, 62, 55, 78, 96, 29, 22, 24, 13,
        14, 11, 11, 18, 12, 12, 30, 52, 52, 44, 28, 28, 20, 56, 40, 31, 50, 40, 46, 42,
        29, 19, 36, 25, 22, 17, 19, 26, 30, 20, 15, 21, 11, 8, 8, 19, 5, 8, 8, 11,
        11, 8, 3, 9, 5, 4, 7, 3, 6, 3, 5, 4, 5, 6
    ];
    
    // ููุน ุงููุฒูู (ูููุฉ/ูุฏููุฉ)
    const revelationTypes = [
        "ูููุฉ", "ูุฏููุฉ", "ูุฏููุฉ", "ูุฏููุฉ", "ูุฏููุฉ", "ูููุฉ", "ูููุฉ", "ูุฏููุฉ", "ูุฏููุฉ", "ูููุฉ",
        "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ",
        "ูููุฉ", "ูุฏููุฉ", "ูููุฉ", "ูุฏููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ",
        "ูููุฉ", "ูููุฉ", "ูุฏููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ",
        "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูุฏููุฉ", "ูุฏููุฉ", "ูุฏููุฉ", "ูููุฉ",
        "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูุฏููุฉ", "ูููุฉ", "ูุฏููุฉ", "ูุฏููุฉ", "ูุฏููุฉ", "ูุฏููุฉ",
        "ูุฏููุฉ", "ูุฏููุฉ", "ูุฏููุฉ", "ูุฏููุฉ", "ูุฏููุฉ", "ูุฏููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ",
        "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูุฏููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ",
        "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ",
        "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูุฏููุฉ", "ูุฏููุฉ", "ูููุฉ",
        "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูุฏููุฉ",
        "ูููุฉ", "ูููุฉ", "ูููุฉ", "ูููุฉ"
    ];

    try {
        // ุชุญููู ูู ุณูุฑุฉ
        for (let i = 1; i <= 114; i++) {
            console.log(`๐ฅ ุชุญููู ุณูุฑุฉ ${surahNames[i-1]} (${i}/114)...`);
            
            try {
                // ุชุญููู ุงููุต ุงูุนุซูุงูู
                const uthmaniData = await fetch(`${QURAN_API}/surah/${i}/ar.uthmani`);
                await delay(300);
                
                // ุชุญููู ุงููุต ุงูุฅููุงุฆู
                const imlaeiData = await fetch(`${QURAN_API}/surah/${i}/ar.imlaei`);
                await delay(300);
                
                if (uthmaniData.code === 200 && imlaeiData.code === 200) {
                    const surah = {
                        id: i,
                        name: surahNames[i-1],
                        name_en: surahNamesEn[i-1],
                        ayah_count: ayahCounts[i-1],
                        revelation_type: revelationTypes[i-1],
                        ayahs: []
                    };
                    
                    const uthmaniAyahs = uthmaniData.data.ayahs;
                    const imlaeiAyahs = imlaeiData.data.ayahs;
                    
                    uthmaniAyahs.forEach((ayah, idx) => {
                        surah.ayahs.push({
                            aya_no: ayah.numberInSurah,
                            aya_no_global: ayah.number,
                            aya_text: ayah.text, // ุงููุต ุงูุนุซูุงูู
                            aya_text_emlaey: imlaeiAyahs[idx].text, // ุงููุต ุงูุฅููุงุฆู
                            page: ayah.page,
                            juz: ayah.juz,
                            hizb: ayah.hizbQuarter,
                            sajda: ayah.sajda || false
                        });
                    });
                    
                    quranData.surahs.push(surah);
                    console.log(`   โ ุชู ุชุญููู ${surah.ayahs.length} ุขูุฉ`);
                }
            } catch (e) {
                console.log(`   โ ุฎุทุฃ ูู ุชุญููู ุงูุณูุฑุฉ ${i}: ${e.message}`);
            }
        }
        
        // ุญูุธ ุงูููู
        const outputPath = './quran_data.json';
        fs.writeFileSync(outputPath, JSON.stringify(quranData, null, 2), 'utf8');
        
        const stats = fs.statSync(outputPath);
        const sizeMB = (stats.size / (1024 * 1024)).toFixed(2);
        
        console.log('\n๐ ุชู ุฅูุดุงุก ุงูููู ุจูุฌุงุญ!');
        console.log(`๐ ุงูููู: ${outputPath}`);
        console.log(`๐ ุงูุญุฌู: ${sizeMB} MB`);
        console.log(`๐ ุงูุณูุฑ: ${quranData.surahs.length}`);
        
        let totalAyahs = 0;
        quranData.surahs.forEach(s => totalAyahs += s.ayahs.length);
        console.log(`๐ ุงูุขูุงุช: ${totalAyahs}`);
        
    } catch (error) {
        console.error('โ ุฎุทุฃ:', error.message);
    }
}
